{
    "version": 3,
    "terraform_version": "0.9.6",
    "serial": 50,
    "lineage": "bb2a9eb0-40a9-457d-8192-e772986f32a3",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {
                "kubernetes_master_public_ip": {
                    "sensitive": false,
                    "type": "string",
                    "value": "54.223.215.75"
                },
                "kubernetes_workers_public_ip": {
                    "sensitive": false,
                    "type": "string",
                    "value": ""
                }
            },
            "resources": {
                "aws_iam_instance_profile.master_profile": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.master_role"
                    ],
                    "primary": {
                        "id": "master_profile",
                        "attributes": {
                            "arn": "arn:aws-cn:iam::493490470276:instance-profile/master_profile",
                            "id": "master_profile",
                            "name": "master_profile",
                            "path": "/",
                            "role": "master_role",
                            "roles.#": "1",
                            "roles.2094835459": "master_role",
                            "unique_id": "AIPAP2XQ6ISEGJN5OXGH4"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_instance_profile.worker_profile": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.worker_role"
                    ],
                    "primary": {
                        "id": "worker_profile",
                        "attributes": {
                            "arn": "arn:aws-cn:iam::493490470276:instance-profile/worker_profile",
                            "id": "worker_profile",
                            "name": "worker_profile",
                            "path": "/",
                            "role": "worker_role",
                            "roles.#": "1",
                            "roles.2628533307": "worker_role",
                            "unique_id": "AIPAPWVEVGLVEDRBDRT6U"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role.master_role": {
                    "type": "aws_iam_role",
                    "depends_on": [],
                    "primary": {
                        "id": "master_role",
                        "attributes": {
                            "arn": "arn:aws-cn:iam::493490470276:role/master_role",
                            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com.cn\"},\"Action\":\"sts:AssumeRole\"}]}",
                            "create_date": "2017-07-27T09:48:05Z",
                            "id": "master_role",
                            "name": "master_role",
                            "path": "/",
                            "unique_id": "AROAPGSOASNZRBV7WU4LS"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role.worker_role": {
                    "type": "aws_iam_role",
                    "depends_on": [],
                    "primary": {
                        "id": "worker_role",
                        "attributes": {
                            "arn": "arn:aws-cn:iam::493490470276:role/worker_role",
                            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com.cn\"},\"Action\":\"sts:AssumeRole\"}]}",
                            "create_date": "2017-07-27T09:48:05Z",
                            "id": "worker_role",
                            "name": "worker_role",
                            "path": "/",
                            "unique_id": "AROAPXPDSY7BF7CNEXQFY"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role_policy.master_policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.master_role"
                    ],
                    "primary": {
                        "id": "master_role:master_policy",
                        "attributes": {
                            "id": "master_role:master_policy",
                            "name": "master_policy",
                            "policy": "{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n    {\n        \"Action\" : [\"ec2:*\"],\n        \"Effect\": \"Allow\",\n        \"Resource\": [\"*\"]\n    },\n    {\n        \"Action\" : [\"elasticloadbalancing:*\"],\n        \"Effect\": \"Allow\",\n        \"Resource\": [\"*\"]\n    },\n    {\n        \"Action\": \"ecr:*\",\n        \"Effect\": \"Allow\",\n        \"Resource\": \"*\"\n    }\n  ]\n}\n",
                            "role": "master_role"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role_policy.worker_policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.worker_role"
                    ],
                    "primary": {
                        "id": "worker_role:worker_policy",
                        "attributes": {
                            "id": "worker_role:worker_policy",
                            "name": "worker_policy",
                            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:Describe*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:AttachVolume\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"ec2:DetachVolume\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n",
                            "role": "worker_role"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_instance.master": {
                    "type": "aws_instance",
                    "depends_on": [
                        "aws_iam_instance_profile.master_profile",
                        "aws_security_group.k8s-master",
                        "aws_subnet.kubernetes",
                        "data.template_file.master_yaml"
                    ],
                    "primary": {
                        "id": "i-0fbc3e013ce8e11fc",
                        "attributes": {
                            "ami": "ami-ca5c8da7",
                            "associate_public_ip_address": "true",
                            "availability_zone": "cn-north-1b",
                            "disable_api_termination": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "master_profile",
                            "id": "i-0fbc3e013ce8e11fc",
                            "instance_state": "running",
                            "instance_type": "t2.micro",
                            "ipv6_addresses.#": "0",
                            "key_name": "k8s",
                            "monitoring": "false",
                            "network_interface.#": "0",
                            "network_interface_id": "eni-40d06e6a",
                            "primary_network_interface_id": "eni-40d06e6a",
                            "private_dns": "ip-10-0-176-64.cn-north-1.compute.internal",
                            "private_ip": "10.0.176.64",
                            "public_dns": "ec2-54-223-215-75.cn-north-1.compute.amazonaws.com.cn",
                            "public_ip": "54.223.215.75",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "100",
                            "root_block_device.0.volume_size": "25",
                            "root_block_device.0.volume_type": "gp2",
                            "security_groups.#": "0",
                            "source_dest_check": "true",
                            "subnet_id": "subnet-9efb8ee9",
                            "tags.%": "1",
                            "tags.Name": "k8s-master",
                            "tenancy": "default",
                            "user_data": "6ce54106472d04f767b9afaa12eb450ec37125fd",
                            "volume_tags.%": "0",
                            "vpc_security_group_ids.#": "1",
                            "vpc_security_group_ids.3409165069": "sg-840084e0"
                        },
                        "meta": {
                            "e2bfb730-ecaa-11e6-8f88-34363bc7c4c0": {
                                "create": 600000000000,
                                "delete": 600000000000,
                                "update": 600000000000
                            },
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_internet_gateway.gw": {
                    "type": "aws_internet_gateway",
                    "depends_on": [
                        "aws_vpc.kubernetes"
                    ],
                    "primary": {
                        "id": "igw-ebcfa78e",
                        "attributes": {
                            "id": "igw-ebcfa78e",
                            "tags.%": "0",
                            "vpc_id": "vpc-fd51f299"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table.kubernetes": {
                    "type": "aws_route_table",
                    "depends_on": [
                        "aws_internet_gateway.gw",
                        "aws_vpc.kubernetes"
                    ],
                    "primary": {
                        "id": "rtb-d1a6b7b4",
                        "attributes": {
                            "id": "rtb-d1a6b7b4",
                            "propagating_vgws.#": "0",
                            "route.#": "1",
                            "route.3770589639.cidr_block": "0.0.0.0/0",
                            "route.3770589639.egress_only_gateway_id": "",
                            "route.3770589639.gateway_id": "igw-ebcfa78e",
                            "route.3770589639.instance_id": "",
                            "route.3770589639.ipv6_cidr_block": "",
                            "route.3770589639.nat_gateway_id": "",
                            "route.3770589639.network_interface_id": "",
                            "route.3770589639.vpc_peering_connection_id": "",
                            "tags.%": "0",
                            "vpc_id": "vpc-fd51f299"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table_association.kubernetes": {
                    "type": "aws_route_table_association",
                    "depends_on": [
                        "aws_route_table.kubernetes",
                        "aws_subnet.kubernetes"
                    ],
                    "primary": {
                        "id": "rtbassoc-bc8098d9",
                        "attributes": {
                            "id": "rtbassoc-bc8098d9",
                            "route_table_id": "rtb-d1a6b7b4",
                            "subnet_id": "subnet-9efb8ee9"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.k8s-master": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_vpc.kubernetes"
                    ],
                    "primary": {
                        "id": "sg-840084e0",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.ipv6_cidr_blocks.#": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-840084e0",
                            "ingress.#": "2",
                            "ingress.1463360607.cidr_blocks.#": "1",
                            "ingress.1463360607.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.1463360607.from_port": "6443",
                            "ingress.1463360607.ipv6_cidr_blocks.#": "0",
                            "ingress.1463360607.protocol": "TCP",
                            "ingress.1463360607.security_groups.#": "0",
                            "ingress.1463360607.self": "false",
                            "ingress.1463360607.to_port": "6443",
                            "ingress.482069346.cidr_blocks.#": "1",
                            "ingress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.482069346.from_port": "0",
                            "ingress.482069346.ipv6_cidr_blocks.#": "0",
                            "ingress.482069346.protocol": "-1",
                            "ingress.482069346.security_groups.#": "0",
                            "ingress.482069346.self": "false",
                            "ingress.482069346.to_port": "0",
                            "name": "k8s-master",
                            "owner_id": "493490470276",
                            "tags.%": "0",
                            "vpc_id": "vpc-fd51f299"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.k8s-worker": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_security_group.k8s-master",
                        "aws_vpc.kubernetes"
                    ],
                    "primary": {
                        "id": "sg-04048060",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.ipv6_cidr_blocks.#": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-04048060",
                            "ingress.#": "3",
                            "ingress.1960698028.cidr_blocks.#": "1",
                            "ingress.1960698028.cidr_blocks.0": "10.0.0.0/16",
                            "ingress.1960698028.from_port": "0",
                            "ingress.1960698028.ipv6_cidr_blocks.#": "0",
                            "ingress.1960698028.protocol": "-1",
                            "ingress.1960698028.security_groups.#": "0",
                            "ingress.1960698028.self": "false",
                            "ingress.1960698028.to_port": "0",
                            "ingress.4157598914.cidr_blocks.#": "0",
                            "ingress.4157598914.from_port": "0",
                            "ingress.4157598914.ipv6_cidr_blocks.#": "0",
                            "ingress.4157598914.protocol": "-1",
                            "ingress.4157598914.security_groups.#": "1",
                            "ingress.4157598914.security_groups.3409165069": "sg-840084e0",
                            "ingress.4157598914.self": "false",
                            "ingress.4157598914.to_port": "0",
                            "ingress.482069346.cidr_blocks.#": "1",
                            "ingress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.482069346.from_port": "0",
                            "ingress.482069346.ipv6_cidr_blocks.#": "0",
                            "ingress.482069346.protocol": "-1",
                            "ingress.482069346.security_groups.#": "0",
                            "ingress.482069346.self": "false",
                            "ingress.482069346.to_port": "0",
                            "name": "k8s-worker",
                            "owner_id": "493490470276",
                            "tags.%": "0",
                            "vpc_id": "vpc-fd51f299"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_subnet.kubernetes": {
                    "type": "aws_subnet",
                    "depends_on": [
                        "aws_vpc.kubernetes"
                    ],
                    "primary": {
                        "id": "subnet-9efb8ee9",
                        "attributes": {
                            "assign_ipv6_address_on_creation": "false",
                            "availability_zone": "cn-north-1b",
                            "cidr_block": "10.0.0.0/16",
                            "id": "subnet-9efb8ee9",
                            "map_public_ip_on_launch": "false",
                            "tags.%": "0",
                            "vpc_id": "vpc-fd51f299"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_vpc.kubernetes": {
                    "type": "aws_vpc",
                    "depends_on": [],
                    "primary": {
                        "id": "vpc-fd51f299",
                        "attributes": {
                            "assign_generated_ipv6_cidr_block": "false",
                            "cidr_block": "10.0.0.0/16",
                            "default_network_acl_id": "acl-8c998fe9",
                            "default_route_table_id": "rtb-d6a4b5b3",
                            "default_security_group_id": "sg-7d7afe19",
                            "dhcp_options_id": "dopt-22f98147",
                            "enable_dns_hostnames": "true",
                            "enable_dns_support": "true",
                            "id": "vpc-fd51f299",
                            "instance_tenancy": "default",
                            "main_route_table_id": "rtb-d6a4b5b3",
                            "tags.%": "0"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_file.master_yaml": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "e7f76bfcdc3076292434ec53ebec2b87ffb144c64c9ab99c60105e7cf591a1b9",
                        "attributes": {
                            "id": "e7f76bfcdc3076292434ec53ebec2b87ffb144c64c9ab99c60105e7cf591a1b9",
                            "rendered": "#cloud-config\n\nwrite_files:\n  - path: \"/etc/flannel/options.env\"\n    permissions: \"0755\"\n    content: |\n        FLANNELD_IFACE=$private_ipv4\n        FLANNELD_ETCD_ENDPOINTS=https://127.0.0.1:2379\n        FLANNELD_ETCD_CAFILE=/etc/ssl/etcd/ca.pem\n        FLANNELD_ETCD_CERTFILE=/etc/ssl/etcd/client.pem\n        FLANNELD_ETCD_KEYFILE=/etc/ssl/etcd/client-key.pem\n  - path: \"/etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env\n  - path: \"/etc/systemd/system/docker.service.d/40-flannel.conf\"\n    permissions: \"0755\"\n    content: |\n        [Unit]\n        Requires=flanneld.service\n        After=flanneld.service\n        [Service]\n        TimeoutStartSec=3600\n  - path: \"/etc/systemd/system/kubelet.service\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        Environment=KUBELET_IMAGE_TAG=v1.7.1_coreos.0\n        Environment=\"RKT_RUN_ARGS=--uuid-file-save=/var/run/kubelet-pod.uuid \\\n          --volume var-log,kind=host,source=/var/log \\\n          --mount volume=var-log,target=/var/log \\\n          --volume dns,kind=host,source=/etc/resolv.conf \\\n          --mount volume=dns,target=/etc/resolv.conf\"\n        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests\n        ExecStartPre=/usr/bin/mkdir -p /var/log/containers\n        ExecStartPre=-/usr/bin/rkt rm --uuid-file=/var/run/kubelet-pod.uuid\n        ExecStart=/usr/lib/coreos/kubelet-wrapper \\\n          --anonymous-auth=false \\\n          --client-ca-file=/etc/kubernetes/ssl/ca.pem \\\n          --api-servers=http://127.0.0.1:8080 \\\n          --network-plugin-dir=/etc/kubernetes/cni/net.d \\\n          --register-schedulable=false \\\n          --container-runtime=docker \\\n          --allow-privileged=true \\\n          --pod-manifest-path=/etc/kubernetes/manifests \\\n          --hostname-override=$private_ipv4 \\\n          --cluster-dns=10.3.0.10 \\\n          --cluster-domain=cluster.local\n        ExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid\n        Restart=always\n        RestartSec=10\n\n        [Install]\n        WantedBy=multi-user.target\n  - path: \"/etc/kubernetes/manifests/kube-apiserver.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-apiserver\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-apiserver\n            image: quay.io/coreos/hyperkube:v1.7.1_coreos.0\n            command:\n            - /hyperkube\n            - apiserver\n            - --bind-address=0.0.0.0\n            - --etcd-servers=https://127.0.0.1:2379\n            - --etcd-cafile=/etc/kubernetes/ssl/ca.pem\n            - --etcd-certfile=/etc/kubernetes/ssl/client.pem\n            - --etcd-keyfile=/etc/kubernetes/ssl/client-key.pem\n            - --kubelet-client-certificate=/etc/kubernetes/ssl/client.pem\n            - --kubelet-client-key=/etc/kubernetes/ssl/client-key.pem\n            - --allow-privileged=true\n            - --service-cluster-ip-range=10.3.0.0/24\n            - --secure-port=443\n            - --advertise-address=$private_ipv4\n            - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n            - --tls-cert-file=/etc/kubernetes/ssl/apiserver.pem\n            - --tls-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --client-ca-file=/etc/kubernetes/ssl/ca.pem\n            - --service-account-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --runtime-config=extensions/v1beta1/networkpolicies=true\n            - --anonymous-auth=false\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                port: 8080\n                path: /healthz\n              initialDelaySeconds: 15\n              timeoutSeconds: 15\n            ports:\n            - containerPort: 443\n              hostPort: 443\n              name: https\n            - containerPort: 8080\n              hostPort: 8080\n              name: local\n            volumeMounts:\n            - mountPath: /etc/kubernetes/ssl\n              name: ssl-certs-kubernetes\n              readOnly: true\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /etc/kubernetes/ssl\n            name: ssl-certs-kubernetes\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-proxy.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-proxy\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-proxy\n            image: quay.io/coreos/hyperkube:v1.7.1_coreos.0\n            command:\n            - /hyperkube\n            - proxy\n            - --master=http://127.0.0.1:8080\n            - --proxy-mode=iptables\n            securityContext:\n              privileged: true\n            volumeMounts:\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-controller-manager.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-controller-manager\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-controller-manager\n            image: quay.io/coreos/hyperkube:v1.7.1_coreos.0\n            command:\n            - /hyperkube\n            - controller-manager\n            - --master=http://127.0.0.1:8080\n            - --leader-elect=true\n            - --service-account-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --root-ca-file=/etc/kubernetes/ssl/ca.pem\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                path: /healthz\n                port: 10252\n              initialDelaySeconds: 15\n              timeoutSeconds: 1\n            volumeMounts:\n            - mountPath: /etc/kubernetes/ssl\n              name: ssl-certs-kubernetes\n              readOnly: true\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /etc/kubernetes/ssl\n            name: ssl-certs-kubernetes\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-scheduler.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-scheduler\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-scheduler\n            image: quay.io/coreos/hyperkube:v1.7.1_coreos.0\n            command:\n            - /hyperkube\n            - scheduler\n            - --master=http://127.0.0.1:8080\n            - --leader-elect=true\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                path: /healthz\n                port: 10251\n              initialDelaySeconds: 15\n              timeoutSeconds: 15\n",
                            "template": "#cloud-config\n\nwrite_files:\n  - path: \"/etc/flannel/options.env\"\n    permissions: \"0755\"\n    content: |\n        FLANNELD_IFACE=$private_ipv4\n        FLANNELD_ETCD_ENDPOINTS=https://${ETCD_IP}:2379\n        FLANNELD_ETCD_CAFILE=/etc/ssl/etcd/ca.pem\n        FLANNELD_ETCD_CERTFILE=/etc/ssl/etcd/client.pem\n        FLANNELD_ETCD_KEYFILE=/etc/ssl/etcd/client-key.pem\n  - path: \"/etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env\n  - path: \"/etc/systemd/system/docker.service.d/40-flannel.conf\"\n    permissions: \"0755\"\n    content: |\n        [Unit]\n        Requires=flanneld.service\n        After=flanneld.service\n        [Service]\n        TimeoutStartSec=3600\n  - path: \"/etc/systemd/system/kubelet.service\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        Environment=KUBELET_IMAGE_TAG=${HYPERKUBE_VERSION}\n        Environment=\"RKT_RUN_ARGS=--uuid-file-save=/var/run/kubelet-pod.uuid \\\n          --volume var-log,kind=host,source=/var/log \\\n          --mount volume=var-log,target=/var/log \\\n          --volume dns,kind=host,source=/etc/resolv.conf \\\n          --mount volume=dns,target=/etc/resolv.conf\"\n        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests\n        ExecStartPre=/usr/bin/mkdir -p /var/log/containers\n        ExecStartPre=-/usr/bin/rkt rm --uuid-file=/var/run/kubelet-pod.uuid\n        ExecStart=/usr/lib/coreos/kubelet-wrapper \\\n          --anonymous-auth=false \\\n          --client-ca-file=/etc/kubernetes/ssl/ca.pem \\\n          --api-servers=http://127.0.0.1:8080 \\\n          --network-plugin-dir=/etc/kubernetes/cni/net.d \\\n          --register-schedulable=false \\\n          --container-runtime=docker \\\n          --allow-privileged=true \\\n          --pod-manifest-path=/etc/kubernetes/manifests \\\n          --hostname-override=$private_ipv4 \\\n          --cluster-dns=${DNS_SERVICE_IP} \\\n          --cluster-domain=cluster.local\n        ExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid\n        Restart=always\n        RestartSec=10\n\n        [Install]\n        WantedBy=multi-user.target\n  - path: \"/etc/kubernetes/manifests/kube-apiserver.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-apiserver\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-apiserver\n            image: quay.io/coreos/hyperkube:${HYPERKUBE_VERSION}\n            command:\n            - /hyperkube\n            - apiserver\n            - --bind-address=0.0.0.0\n            - --etcd-servers=https://${ETCD_IP}:2379\n            - --etcd-cafile=/etc/kubernetes/ssl/ca.pem\n            - --etcd-certfile=/etc/kubernetes/ssl/client.pem\n            - --etcd-keyfile=/etc/kubernetes/ssl/client-key.pem\n            - --kubelet-client-certificate=/etc/kubernetes/ssl/client.pem\n            - --kubelet-client-key=/etc/kubernetes/ssl/client-key.pem\n            - --allow-privileged=true\n            - --service-cluster-ip-range=${SERVICE_IP_RANGE}\n            - --secure-port=443\n            - --advertise-address=$private_ipv4\n            - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n            - --tls-cert-file=/etc/kubernetes/ssl/apiserver.pem\n            - --tls-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --client-ca-file=/etc/kubernetes/ssl/ca.pem\n            - --service-account-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --runtime-config=extensions/v1beta1/networkpolicies=true\n            - --anonymous-auth=false\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                port: 8080\n                path: /healthz\n              initialDelaySeconds: 15\n              timeoutSeconds: 15\n            ports:\n            - containerPort: 443\n              hostPort: 443\n              name: https\n            - containerPort: 8080\n              hostPort: 8080\n              name: local\n            volumeMounts:\n            - mountPath: /etc/kubernetes/ssl\n              name: ssl-certs-kubernetes\n              readOnly: true\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /etc/kubernetes/ssl\n            name: ssl-certs-kubernetes\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-proxy.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-proxy\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-proxy\n            image: quay.io/coreos/hyperkube:${HYPERKUBE_VERSION}\n            command:\n            - /hyperkube\n            - proxy\n            - --master=http://127.0.0.1:8080\n            - --proxy-mode=iptables\n            securityContext:\n              privileged: true\n            volumeMounts:\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-controller-manager.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-controller-manager\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-controller-manager\n            image: quay.io/coreos/hyperkube:${HYPERKUBE_VERSION}\n            command:\n            - /hyperkube\n            - controller-manager\n            - --master=http://127.0.0.1:8080\n            - --leader-elect=true\n            - --service-account-private-key-file=/etc/kubernetes/ssl/apiserver-key.pem\n            - --root-ca-file=/etc/kubernetes/ssl/ca.pem\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                path: /healthz\n                port: 10252\n              initialDelaySeconds: 15\n              timeoutSeconds: 1\n            volumeMounts:\n            - mountPath: /etc/kubernetes/ssl\n              name: ssl-certs-kubernetes\n              readOnly: true\n            - mountPath: /etc/ssl/certs\n              name: ssl-certs-host\n              readOnly: true\n          volumes:\n          - hostPath:\n              path: /etc/kubernetes/ssl\n            name: ssl-certs-kubernetes\n          - hostPath:\n              path: /usr/share/ca-certificates\n            name: ssl-certs-host\n  - path: \"/etc/kubernetes/manifests/kube-scheduler.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-scheduler\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-scheduler\n            image: quay.io/coreos/hyperkube:${HYPERKUBE_VERSION}\n            command:\n            - /hyperkube\n            - scheduler\n            - --master=http://127.0.0.1:8080\n            - --leader-elect=true\n            livenessProbe:\n              httpGet:\n                host: 127.0.0.1\n                path: /healthz\n                port: 10251\n              initialDelaySeconds: 15\n              timeoutSeconds: 15\n",
                            "vars.%": "5",
                            "vars.DNS_SERVICE_IP": "10.3.0.10",
                            "vars.ETCD_IP": "127.0.0.1",
                            "vars.HYPERKUBE_VERSION": "v1.7.1_coreos.0",
                            "vars.POD_NETWORK": "10.2.0.0/16",
                            "vars.SERVICE_IP_RANGE": "10.3.0.0/24"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_file.worker_yaml": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_instance.master"
                    ],
                    "primary": {
                        "id": "427c71f4d935d076d9af9ff43bd97e0131e152826bb4e5b66f485c32d6c596e4",
                        "attributes": {
                            "id": "427c71f4d935d076d9af9ff43bd97e0131e152826bb4e5b66f485c32d6c596e4",
                            "rendered": "#cloud-config\n\n\nwrite_files:\n  - path: \"/etc/flannel/options.env\"\n    permissions: \"0755\"\n    content: |\n        FLANNELD_IFACE=$private_ipv4\n        FLANNELD_ETCD_ENDPOINTS=https://10.0.176.64:2379\n        FLANNELD_ETCD_CAFILE=/etc/ssl/etcd/ca.pem\n        FLANNELD_ETCD_CERTFILE=/etc/ssl/etcd/worker.pem\n        FLANNELD_ETCD_KEYFILE=/etc/ssl/etcd/worker-key.pem\n  - path: \"/etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env\n  - path: \"/etc/systemd/system/docker.service.d/40-flannel.conf\"\n    permissions: \"0755\"\n    content: |\n        [Unit]\n        Requires=flanneld.service\n        After=flanneld.service\n  - path: \"/etc/systemd/system/kubelet.service\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        Environment=KUBELET_IMAGE_TAG=v1.7.1_coreos.0\n        Environment=\"RKT_RUN_ARGS=--uuid-file-save=/var/run/kubelet-pod.uuid \\\n          --volume dns,kind=host,source=/etc/resolv.conf \\\n          --mount volume=dns,target=/etc/resolv.conf \\\n          --volume var-log,kind=host,source=/var/log \\\n          --mount volume=var-log,target=/var/log\"\n        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests\n        ExecStartPre=/usr/bin/mkdir -p /var/log/containers\n        ExecStartPre=-/usr/bin/rkt rm --uuid-file=/var/run/kubelet-pod.uuid\n        ExecStart=/usr/lib/coreos/kubelet-wrapper \\\n          --anonymous-auth=false \\\n          --client-ca-file=/etc/kubernetes/ssl/ca.pem \\\n          --api-servers=https://10.0.176.64 \\\n          --network-plugin-dir=/etc/kubernetes/cni/net.d \\\n          --container-runtime=docker \\\n          --register-node=true \\\n          --allow-privileged=true \\\n          --pod-manifest-path=/etc/kubernetes/manifests \\\n          --hostname-override=$private_ipv4 \\\n          --cluster-dns=10.3.0.10 \\\n          --cluster-domain=cluster.local \\\n          --kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml \\\n          --tls-cert-file=/etc/kubernetes/ssl/worker.pem \\\n          --tls-private-key-file=/etc/kubernetes/ssl/worker-key.pem\n        ExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid\n        Restart=always\n        RestartSec=10\n\n        [Install]\n        WantedBy=multi-user.target\n  - path: \"/etc/kubernetes/manifests/kube-proxy.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-proxy\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-proxy\n            image: quay.io/coreos/hyperkube:v1.7.1_coreos.0\n            command:\n            - /hyperkube\n            - proxy\n            - --master=https://10.0.176.64\n            - --kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml\n            - --proxy-mode=iptables\n            securityContext:\n              privileged: true\n            volumeMounts:\n              - mountPath: /etc/ssl/certs\n                name: \"ssl-certs\"\n              - mountPath: /etc/kubernetes/worker-kubeconfig.yaml\n                name: \"kubeconfig\"\n                readOnly: true\n              - mountPath: /etc/kubernetes/ssl\n                name: \"etc-kube-ssl\"\n                readOnly: true\n          volumes:\n            - name: \"ssl-certs\"\n              hostPath:\n                path: \"/usr/share/ca-certificates\"\n            - name: \"kubeconfig\"\n              hostPath:\n                path: \"/etc/kubernetes/worker-kubeconfig.yaml\"\n            - name: \"etc-kube-ssl\"\n              hostPath:\n                path: \"/etc/kubernetes/ssl\"\n  - path: \"/etc/kubernetes/worker-kubeconfig.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Config\n        clusters:\n        - name: local\n          cluster:\n            certificate-authority: /etc/kubernetes/ssl/ca.pem\n        users:\n        - name: kubelet\n          user:\n            client-certificate: /etc/kubernetes/ssl/worker.pem\n            client-key: /etc/kubernetes/ssl/worker-key.pem\n        contexts:\n        - context:\n            cluster: local\n            user: kubelet\n          name: kubelet-context\n        current-context: kubelet-context\n",
                            "template": "#cloud-config\n\n\nwrite_files:\n  - path: \"/etc/flannel/options.env\"\n    permissions: \"0755\"\n    content: |\n        FLANNELD_IFACE=$private_ipv4\n        FLANNELD_ETCD_ENDPOINTS=https://${ETCD_IP}:2379\n        FLANNELD_ETCD_CAFILE=/etc/ssl/etcd/ca.pem\n        FLANNELD_ETCD_CERTFILE=/etc/ssl/etcd/worker.pem\n        FLANNELD_ETCD_KEYFILE=/etc/ssl/etcd/worker-key.pem\n  - path: \"/etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env\n  - path: \"/etc/systemd/system/docker.service.d/40-flannel.conf\"\n    permissions: \"0755\"\n    content: |\n        [Unit]\n        Requires=flanneld.service\n        After=flanneld.service\n  - path: \"/etc/systemd/system/kubelet.service\"\n    permissions: \"0755\"\n    content: |\n        [Service]\n        Environment=KUBELET_IMAGE_TAG=${HYPERKUBE_VERSION}\n        Environment=\"RKT_RUN_ARGS=--uuid-file-save=/var/run/kubelet-pod.uuid \\\n          --volume dns,kind=host,source=/etc/resolv.conf \\\n          --mount volume=dns,target=/etc/resolv.conf \\\n          --volume var-log,kind=host,source=/var/log \\\n          --mount volume=var-log,target=/var/log\"\n        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests\n        ExecStartPre=/usr/bin/mkdir -p /var/log/containers\n        ExecStartPre=-/usr/bin/rkt rm --uuid-file=/var/run/kubelet-pod.uuid\n        ExecStart=/usr/lib/coreos/kubelet-wrapper \\\n          --anonymous-auth=false \\\n          --client-ca-file=/etc/kubernetes/ssl/ca.pem \\\n          --api-servers=https://${MASTER_HOST} \\\n          --network-plugin-dir=/etc/kubernetes/cni/net.d \\\n          --container-runtime=docker \\\n          --register-node=true \\\n          --allow-privileged=true \\\n          --pod-manifest-path=/etc/kubernetes/manifests \\\n          --hostname-override=$private_ipv4 \\\n          --cluster-dns=${DNS_SERVICE_IP} \\\n          --cluster-domain=cluster.local \\\n          --kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml \\\n          --tls-cert-file=/etc/kubernetes/ssl/worker.pem \\\n          --tls-private-key-file=/etc/kubernetes/ssl/worker-key.pem\n        ExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid\n        Restart=always\n        RestartSec=10\n\n        [Install]\n        WantedBy=multi-user.target\n  - path: \"/etc/kubernetes/manifests/kube-proxy.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Pod\n        metadata:\n          name: kube-proxy\n          namespace: kube-system\n        spec:\n          hostNetwork: true\n          containers:\n          - name: kube-proxy\n            image: quay.io/coreos/hyperkube:${HYPERKUBE_VERSION}\n            command:\n            - /hyperkube\n            - proxy\n            - --master=https://${MASTER_HOST}\n            - --kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml\n            - --proxy-mode=iptables\n            securityContext:\n              privileged: true\n            volumeMounts:\n              - mountPath: /etc/ssl/certs\n                name: \"ssl-certs\"\n              - mountPath: /etc/kubernetes/worker-kubeconfig.yaml\n                name: \"kubeconfig\"\n                readOnly: true\n              - mountPath: /etc/kubernetes/ssl\n                name: \"etc-kube-ssl\"\n                readOnly: true\n          volumes:\n            - name: \"ssl-certs\"\n              hostPath:\n                path: \"/usr/share/ca-certificates\"\n            - name: \"kubeconfig\"\n              hostPath:\n                path: \"/etc/kubernetes/worker-kubeconfig.yaml\"\n            - name: \"etc-kube-ssl\"\n              hostPath:\n                path: \"/etc/kubernetes/ssl\"\n  - path: \"/etc/kubernetes/worker-kubeconfig.yaml\"\n    permissions: \"0755\"\n    content: |\n        apiVersion: v1\n        kind: Config\n        clusters:\n        - name: local\n          cluster:\n            certificate-authority: /etc/kubernetes/ssl/ca.pem\n        users:\n        - name: kubelet\n          user:\n            client-certificate: /etc/kubernetes/ssl/worker.pem\n            client-key: /etc/kubernetes/ssl/worker-key.pem\n        contexts:\n        - context:\n            cluster: local\n            user: kubelet\n          name: kubelet-context\n        current-context: kubelet-context\n",
                            "vars.%": "4",
                            "vars.DNS_SERVICE_IP": "10.3.0.10",
                            "vars.ETCD_IP": "10.0.176.64",
                            "vars.HYPERKUBE_VERSION": "v1.7.1_coreos.0",
                            "vars.MASTER_HOST": "10.0.176.64"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "null_resource.make_admin_key": {
                    "type": "null_resource",
                    "depends_on": [
                        "aws_instance.worker"
                    ],
                    "primary": {
                        "id": "9195271744321157995",
                        "attributes": {
                            "id": "9195271744321157995"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "null_resource.setup_kubectl": {
                    "type": "null_resource",
                    "depends_on": [
                        "aws_instance.master",
                        "null_resource.make_admin_key"
                    ],
                    "primary": {
                        "id": "1444237292959138151",
                        "attributes": {
                            "id": "1444237292959138151"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        }
    ]
}
